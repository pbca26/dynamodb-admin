<ol class="breadcrumb">
  <% for (const item of breadcrumb) { %>
  <a class="breadcrumb-item<%= item.active ? ' active' : '' %>" <%- item.href ? `href="${item.href}"`: '' %>><%= item.text %>
    <% if (item.badge) { %>
      <span class="badge badge-secondary badge-pill ml-1"><%= item.badge %></span>
    <% } %>
  </a>
  <% } %>
  <div class="flex-fill"></div>
  <div class="export-to-json-block">
    Export to JSON <% let formatToggleChecked = exportFormat.toString() === "json" ? "checked" : "" %>
    <input id="export-format-toggle" type="checkbox" <%= formatToggleChecked %> data-toggle="toggle" data-onstyle="json" data-size="xs">
  </div>
  <div>
    Dark Theme <% let checked = theme.toString() === "dark" ? "checked" : "" %>
    <input id="dark-theme-toggle" type="checkbox" <%= checked %> data-toggle="toggle" data-onstyle="dark" data-size="xs">
  </div>
</ol>

<script>
  const DEFAULT_THEME = 'light'
  const DEFAULT_EXPORT_FORMAT = 'json'

  function changeColorScheme(theme) {
    //dark theme preferred, set document with a `data-theme` attribute
    if (theme === "dark") {
      document.documentElement.setAttribute("data-theme", "dark");
    } else {
      document.documentElement.removeAttribute("data-theme");
    }

    //also check or uncheck the toggle
    $('#dark-theme-toggle').attr('checked', theme === "dark");
    document.location.reload();
  }

  function changeExportFormat(exportFormat) {
    //json format preferred, set document with a `data-export-format` attribute
    if (exportFormat === "json") {
      document.documentElement.setAttribute("data-export-format", "json");
    } else {
      document.documentElement.setAttribute("data-export-format", "dynamodb");
    }

    //also check or uncheck the toggle
    $('#export-format-toggle').attr('checked', exportFormat === "json");
  }

  function setCookie(name, val) {
    $.cookie(name, val, { path: '/' });
  }

  function detectColorScheme() {
    const curTheme = document.documentElement.getAttribute("data-theme") || DEFAULT_THEME;

    setCookie('theme', curTheme);
  }

  function detectExportFormat() {
    const exportFormat = document.documentElement.getAttribute("data-export-format") || DEFAULT_EXPORT_FORMAT;

    setCookie('exportFormat', exportFormat);
  }

  $(function () {
    $('#dark-theme-toggle').change(function () {
      const themes = ['light', 'dark'];

      const curTheme = document.documentElement.getAttribute("data-theme") || DEFAULT_THEME;
      const newTheme = curTheme === themes[1] ? themes[0] : themes[1]

      setCookie('theme', newTheme);
      changeColorScheme(newTheme);
    });

    $('#export-format-toggle').change(function () {
      const formats = ['json', 'dynamodb'];

      const curFormat = document.documentElement.getAttribute("data-export-format") || DEFAULT_EXPORT_FORMAT;
      const newFormat = curFormat === formats[1] ? formats[0] : formats[1]

      setCookie('exportFormat', newFormat);
      changeExportFormat(newFormat);
    });

    detectColorScheme();
    detectExportFormat();
  });
</script>
